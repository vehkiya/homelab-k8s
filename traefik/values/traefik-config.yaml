additionalArguments:
  - "--entrypoints.postgres.address=:5432/tcp"

providers:
  # Disable the Ingress provider (optional)
  # We do not want to use Ingress objects anymore!
  # kubernetesIngress:
  # enabled: false
  # Enable the GatewayAPI provider
  kubernetesGateway:
    enabled: true
    nativeLBByDefault: false
    experimentalChannel: true
# Allow the Gateway to expose HTTPRoute from all namespaces
deployment:
  kind: DaemonSet
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`proxy.kerrlab.app`)
    entryPoints: [ "websecure" ]
    # Add custom middlewares : authentication and redirection
    middlewares:
      - name: traefik-dashboard-auth
logs:
  general:
    level: WARN

ports:
  web:
    port: 8000
  websecure:
    port: 8443
    tls:
      enabled: true
    http3:
      enabled: true
    forwardedHeaders:
      trustedIPs:
        - 10.10.1.0/24
        - 10.96.0.0/12
        - fd00:11::/112
        - 10.244.0.0/16
    proxyProtocol:
      trustedIPs:
  postgres:
    port: 5432
    protocol: TCP
    expose:
      default: true
    exposedPort: 5432
gateway:
  enabled: true
  name: traefik-gateway
  namespacePolicy: All
  annotations:
    cert-manager.io/issuer: zerossl-prod
  listeners:
    web:
      port: 8000
    websecure:
      port: 8443
      protocol: HTTPS
      namespacePolicy:
        from: All
      certificateRefs:
        - name: kerrlab-app-tls # Must match the Certificate's metadata.name
          kind: Secret # Must be Secret
tlsStore:
  default:
    defaultCertificate:
      secretName: kerrlab-app-tls
service:
  spec:
    externalTrafficPolicy: Local
  labels:
    pool: cilium-traefik-pool
  annotations:
    tailscale.com/expose: "true"
    tailscale.com/hostname: traefik
extraObjects:
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: traefik-dashboard-auth
      namespace: traefik
    spec:
      basicAuth:
        secret: traefik-dashboard-auth-secret
