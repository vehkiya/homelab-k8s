additionalArguments:
  - "--entrypoints.postgres.address=:5432/tcp"
  - "--entrypoints.torrent-tcp.address=:6883/tcp"
  - "--entrypoints.torrent-udp.address=:6883/udp"

providers:
  # Disable the Ingress provider (optional)
  # We do not want to use Ingress objects anymore!
  # kubernetesIngress:
  # enabled: false
  # Enable the GatewayAPI provider
  kubernetesGateway:
    enabled: true
    nativeLBByDefault: false
    experimentalChannel: true
# Allow the Gateway to expose HTTPRoute from all namespaces

ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`proxy.kerrlab.app`)
    entryPoints: [ "websecure" ]
    # Add custom middlewares : authentication and redirection
    middlewares:
      - name: traefik-dashboard-auth
logs:
  general:
    level: INFO

ports:
  web:
    port: 8000
  websecure:
    port: 8443
    tls:
      enabled: true
    http3:
      enabled: true
    forwardedHeaders:
      trustedIPs:
    proxyProtocol:
      trustedIPs:
  postgres:
    port: 5432
    protocol: TCP
    expose:
      default: true
    exposedPort: 5432
  torrent-tcp: # Unique name for the TCP service port entry
    port: 6883          # Target port in Traefik container (must match entrypoint definition)
    expose:
      default: true
    exposedPort: 6883   # Port the Service listens on for TCP traffic
    protocol: TCP       # Protocol for this service port definition
  torrent-udp: # Unique name for the UDP service port entry
    port: 6883          # Target port in Traefik container (must match entrypoint definition)
    expose:
      default: true
    exposedPort: 6883   # Port the Service listens on for UDP traffic
    protocol: UDP
gateway:
  enabled: true
  name: traefik-gateway
  namespacePolicy: All
  annotations:
    cert-manager.io/issuer: zerossl-prod
  listeners:
    web:
      port: 8000
    websecure:
      port: 8443
      protocol: HTTPS
      namespacePolicy: All
      certificateRefs:
        - name: kerrlab-app-tls # Must match the Certificate's metadata.name
          kind: Secret # Must be Secret
tlsStore:
  default:
    defaultCertificate:
      secretName: kerrlab-app-tls
service:
  labels:
    pool: cilium-traefik-pool
  annotations:
    tailscale.com/expose: "true"
    tailscale.com/hostname: traefik
extraObjects:
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: traefik-dashboard-auth
      namespace: traefik
    spec:
      basicAuth:
        secret: traefik-dashboard-auth-secret
