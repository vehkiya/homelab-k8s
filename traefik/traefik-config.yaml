providers:
  # Disable the Ingress provider (optional)
  # We do not want to use Ingress objects anymore!
  # kubernetesIngress:
  # enabled: false
  # Enable the GatewayAPI provider
  kubernetesGateway:
    enabled: true
    nativeLBByDefault: true
# Allow the Gateway to expose HTTPRoute from all namespaces

ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`proxy.kerrlab.app`)
    entryPoints: [ "websecure" ]
    # Add custom middlewares : authentication and redirection
    middlewares:
    - name: traefik-dashboard-auth
logs:
  general:
    level: INFO
ports:
  websecure:
    forwardedHeaders:
      trustedIPs:
      - 10.96.0.0/12
      - 10.244.0.0/16
    proxyProtocol:
      trustedIPs:
      - 10.96.0.0/12
      - 10.244.0.0/16
gateway:
  enabled: true
  name: traefik-gateway
  namespacePolicy: All
  annotations:
    cert-manager.io/issuer: letsencrypt-prod
  listeners:
    web:
      port: 8000
    websecure:
      port: 8443
      protocol: HTTPS
      namespacePolicy: All
      certificateRefs:
      - name: kerrlab-app-tls # Must match the Certificate's metadata.name
        kind: Secret # Must be Secret
tlsStore:
  default:
    defaultCertificate:
      secretName: kerrlab-app-tls
service:
  labels:
    pool: cilium-traefik-pool
  annotations:
    tailscale.com/expose: "true"
extraObjects:
- apiVersion: v1
  kind: Secret
  metadata:
    name: traefik-dashboard-auth-secret
  type: kubernetes.io/basic-auth
  stringData:
    username: vehkiya
    password: Handstand0-Scribble7-Evasive5-Pond1-Crayon1
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: traefik-dashboard-auth
  spec:
    basicAuth:
      secret: traefik-dashboard-auth-secret
