apiVersion: "cilium.io/v2"
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: "ccnp-global-default-deny"
spec:
  description: "This policy establishes the cluster-wide zero-trust baseline. It selects all endpoints and applies a default-deny for all ingress and egress traffic."
  endpointSelector: { }
  ingress:
    - { }
  egress:
    - { }
---
apiVersion: "cilium.io/v2"
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: "ccnp-allow-health-probes"
spec:
  description: "Allows kubelet liveness/readiness probes and host-level communication from the 'host' and 'health' entities."
  endpointSelector: { }
  ingress:
    - fromEntities:
        - "host"
        - "health"
---
apiVersion: "cilium.io/v2"
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: "ccnp-allow-dns-queries"
spec:
  description: "Allows all Cilium-managed endpoints to send DNS queries to CoreDNS pods in the kube-system namespace."
  endpointSelector:
    matchLabels:
      k8s:io.kubernetes.pod.namespace: kube-system
      k8s-app: coredns
  ingress:
    - fromEndpoints:
        - { }
    - toPorts:
        - ports:
            - port: "53"
              protocol: "UDP"
            - port: "53"
              protocol: "TCP"
