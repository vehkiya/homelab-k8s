additionalArguments:
  - "--entrypoints.postgres.address=:5432/tcp"

providers:
  # Disable the Ingress provider (optional)
  # We do not want to use Ingress objects anymore!
  # kubernetesIngress:
  # enabled: false
  # Enable the GatewayAPI provider
  kubernetesGateway:
    enabled: true
    nativeLBByDefault: false
    experimentalChannel: true
# Allow the Gateway to expose HTTPRoute from all namespaces
deployment:
  kind: DaemonSet
  additionalVolumes:
    - name: plugins

additionalVolumeMounts:
  - name: plugins
    mountPath: /plugins-storage

updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1 # @schema type:[integer, string, null]
    maxSurge: 0
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`proxy.kerrlab.app`)
    entryPoints: [ "websecure" ]
    # Add custom middlewares : authentication and redirection
    middlewares:
      - name: traefik-dashboard-auth
logs:
  general:
    level: WARN

ports:
  web:
    port: 8000
  websecure:
    port: 9443
    tls:
      enabled: true
    http3:
      enabled: true
      advertisedPort: 9443
    forwardedHeaders:
      trustedIPs:
    proxyProtocol:
      trustedIPs:
  dmz:
    port: 8443
    expose:
      default: true
    # We will terminate TLS here
    tls:
      enabled: true
    http3:
      enabled: true
      advertisedPort: 8443
    forwardedHeaders:
      trustedIPs: # Cloudflare Proxy
        - 173.245.48.0/20
        - 103.21.244.0/22
        - 103.22.200.0/22
        - 103.31.4.0/22
        - 141.101.64.0/18
        - 108.162.192.0/18
        - 190.93.240.0/20
        - 188.114.96.0/20
        - 197.234.240.0/22
        - 198.41.128.0/17
        - 162.158.0.0/15
        - 104.16.0.0/13
        - 104.24.0.0/14
        - 172.64.0.0/13
        - 131.0.72.0/22
        - 2400:cb00::/32
        - 2606:4700::/32
        - 2803:f800::/32
        - 2405:b500::/32
        - 2405:8100::/32
        - 2a06:98c0::/29
        - 2c0f:f248::/32
    proxyProtocol:
      trustedIPs:
  postgres:
    port: 5432
    protocol: TCP
    expose:
      default: true
    exposedPort: 5432
gateway:
  enabled: false # Created manually
  name: traefik-gateway
  namespacePolicy: All
  annotations:
    cert-manager.io/issuer: zerossl-prod
  listeners:
    web:
      port: 8000
    websecure:
      port: 9443
      protocol: HTTPS
      namespacePolicy:
        from: All
      certificateRefs:
        - name: kerrlab-app-tls # Must match the Certificate's metadata.name
          kind: Secret # Must be Secret
    dmz:
      port: 8443
      protocol: HTTPS
      namespacePolicy:
        from: All
      certificateRefs:
        - name: kerrlab-app-tls # Must match the Certificate's metadata.name
          kind: Secret # Must be Secret
tlsStore:
  default:
    defaultCertificate:
      secretName: kerrlab-app-tls
service:
  enabled: false # Created manually
  spec:
    externalTrafficPolicy: Local
  labels:
    pool: internal-traefik-lb-pool
  annotations:
    tailscale.com/expose: "true"
    tailscale.com/hostname: traefik
extraObjects:
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: traefik-dashboard-auth
      namespace: traefik
    spec:
      basicAuth:
        secret: traefik-dashboard-auth-secret

experimental:
  fastProxy:
    enabled: true

