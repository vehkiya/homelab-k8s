# authelia/external-secret.yaml
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authelia-secrets
  namespace: core
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: vaultwarden-fields

  target:
    name: authelia-secrets
    creationPolicy: Owner

  data:
    # ---- JWT ----
    - secretKey: JWT_SECRET
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: JWT_SECRET
    # ---- Session ----
    - secretKey: SESSION_SECRET
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: SESSION_ENCRYPTION_KEY
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: 1f0e063d-9fd0-482f-a69a-fc96cb8406cd
        property: Password
    # ---- LDAP ----
    - secretKey: LDAP_PASSWORD
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: LDAP_PASSWORD
    - secretKey: LDAP_BASE_DN
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: LDAP_BASE_DN
    - secretKey: LDAP_BIND_DN
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: LDAP_BIND_DN
    # ---- Storage ----
    - secretKey: STORAGE_PASSWORD
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: db_password
    - secretKey: STORAGE_ENCRYPTION_KEY
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: STORAGE_ENCRYPTION_KEY
    - secretKey: OIDC_HMAC_SECRET
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: OIDC_HMAC_SECRET
    # ---- Notifier ----
    - secretKey: SMTP_USERNAME
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: SMTP_username
    - secretKey: SMTP_PASSWORD
      remoteRef:
        key: f01c0a38-17ef-4135-b6f2-39ece22ae5ff
        property: SMTP_token
---
## authelia/external-secret.yaml
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authelia-secrets-files
  namespace: core
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: vaultwarden-notes

  target:
    name: authelia-secrets-files
    creationPolicy: Owner

  data:
    # ---- JWT ----
    - secretKey: oidc_private.pem
      remoteRef:
        key: bcba88c8-9b83-4ac6-91b4-9c72ebe0c99f
        property: OIDC_ISSUER_PRIVATE_KEY