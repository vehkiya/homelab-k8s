apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: qbittorrent
  namespace: media
spec:
  serviceName: qbittorrent
  replicas: 1
  selector:
    matchLabels:
      app: qbittorrent
  template:
    metadata:
      labels:
        app: qbittorrent
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1 # A higher weight means a stronger preference
              preference:
                matchExpressions:
                  - key: networkSpeed
                    operator: In
                    values:
                      - "2.5G"
      containers:
        - name: qbittorrent
          image: lscr.io/linuxserver/qbittorrent:5.0.4-r0-ls389
          env:
            - name: PGID
              value: "100"
            - name: PUID
              value: "1026"
            - name: TZ
              value: "Europe/Chisinau"
            - name: DOCKER_MODS
              value: ghcr.io/vuetorrent/vuetorrent-lsio-mod:latest
          ports:
            - containerPort: 56883
              name: torrent-port
          volumeMounts:
            - name: downloads-mount
              mountPath: /downloads # Path inside the container
            - name: config
              mountPath: /config
      volumes:
        - name: downloads-mount
          persistentVolumeClaim:
            claimName: downloads-pvc
        - name: config
          persistentVolumeClaim:
            claimName: qbittorrent-config-pvc